$(document).ready(function () {
    // Обработка отправки формы
    $(document).on("click", "#checkoutButtonOrder", function (e) {    
        e.preventDefault(); // Предотвращаем стандартное поведение формы (перезагрузку страницы)

        // Получаем URL из атрибута action формы
        const url = $("#formCreateOrderHref").attr("href");
        // Получаем данные формы
        const formData = $("#formCreateOrder").serialize(); // Собирает данные всех полей формы
        var cartItemsContainer = null
        // Берем элемент счетчика в значке корзины и берем оттуда значение
        var goodsInCartCount = $("#in-cart-count");
        var cartCount = parseInt(goodsInCartCount.text() || 0);
        
        // Выполняем AJAX-запрос
        $.ajax({
            url: url,
            type: "POST",
            data: formData, // Передаём данные формы, собранные методом .serialize()
            headers: {
                "X-CSRFToken": $("[name=csrfmiddlewaretoken]").val(), // Корректно передаём CSRF-токен
            },
            success: function (data) {
                // Сообщение
                Swal.fire({
                    type: 'success',
                    title: "Успешно!",
                    text: "Заказ оформлен! Наш мененджер свяжеться с Вами в ближайшее время.",
                    timer: 7000, // Время в миллисекундах (3 секунды)
                    confirmButtonText: "OK",
                    background: "#f2f2f2",
                    padding: "1rem",
                });
                //Обнуляем значание корзины
                // Обновляем корзину и счётчик товаров
                cartCount = 0;
                goodsInCartCount.text(cartCount);

                // Меняем содержимое корзины на ответ от django (новый отрисованный фрагмент разметки корзины)
                var cartItemsContainer = $("#cart-items-container");
                cartItemsContainer.html(data.cart_items_html);     
            },
            error: function (data) {
                console.log("Ошибка при добавлении товара в корзину");
            },
        });
    });
});

